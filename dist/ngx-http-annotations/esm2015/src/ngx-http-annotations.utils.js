/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { HttpParams, HttpHeaders } from "@angular/common/http";
/**
 * @record
 */
function httpRequestOptions() { }
function httpRequestOptions_tsickle_Closure_declarations() {
    /** @type {?|undefined} */
    httpRequestOptions.prototype.body;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.headers;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.params;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.observe;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.reportProgress;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.responseType;
    /** @type {?|undefined} */
    httpRequestOptions.prototype.withCredentials;
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function observe(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['observe', annotations, ...args]);
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function path(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['path', annotations, ...args]);
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function body(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['body', annotations, ...args]);
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function query(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['query', annotations, ...args]);
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function headers(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['headers', annotations, ...args]);
}
/**
 * @param {?} annotations
 * @return {?}
 */
export function produces(annotations) {
    return (...args) => HttpRestUtils.decorate.apply(this, ['produces', annotations, ...args]);
}
/**
 * @record
 */
function ExtraEntityData() { }
function ExtraEntityData_tsickle_Closure_declarations() {
    /** @type {?} */
    ExtraEntityData.prototype.keyName;
    /** @type {?} */
    ExtraEntityData.prototype.index;
}
const /** @type {?} */ RESOURSE_METADATA_ROOT = 'resources_metadata';
export class HttpRestUtils {
    /**
     * @param {?} decoratorName
     * @param {?} annotations
     * @param {...?} args
     * @return {?}
     */
    static decorate(decoratorName, annotations, ...args) {
        switch (args.length) {
            case 1: {
                const [target] = args;
                HttpRestUtils.constructMetadata.apply(this, [decoratorName, 'class', annotations, target.prototype]);
                break;
            }
            case 2: {
                const [target, key] = args;
                HttpRestUtils.constructMetadata.apply(this, [decoratorName, 'props', annotations, target]);
                break;
            }
            case 3:
                if (typeof args[2] === 'number') {
                    const [target, keyName, index] = args;
                    HttpRestUtils.constructMetadata.apply(this, [decoratorName, 'params', annotations, target, { keyName, index }]);
                    break;
                }
                else {
                    const [target, keyName, descriptor] = args;
                    HttpRestUtils.constructMetadata.apply(this, [decoratorName, 'methods', annotations, target, { keyName }]);
                    break;
                }
            default:
                throw new Error('Decorators are not valid here!');
        }
    }
    /**
     * Set up metadada
     * @param {?} metaName Decorator name
     * @param {?} entityType
     * @param {?} value Value of metadata
     * @param {?} target Prototype of current object
     * @param {?=} entityData Entity extra data
     * @return {?}
     */
    static constructMetadata(metaName, entityType, value, target, entityData) {
        target[RESOURSE_METADATA_ROOT] = target[RESOURSE_METADATA_ROOT] || {};
        target[RESOURSE_METADATA_ROOT][entityType] = target[RESOURSE_METADATA_ROOT][entityType] || {};
        const /** @type {?} */ rootMetadata = target[RESOURSE_METADATA_ROOT];
        const /** @type {?} */ metadataObj = target[RESOURSE_METADATA_ROOT][entityType];
        if (entityData && entityData.keyName) {
            metadataObj[entityData.keyName] = metadataObj[entityData.keyName] || {};
        }
        if (entityData && entityData.index != null) {
            metadataObj[entityData.keyName][metaName] = metadataObj[entityData.keyName][metaName] || {};
        }
        switch (entityType) {
            case 'class':
                metadataObj[metaName] = value;
                break;
            case 'props':
                metadataObj[metaName] = value;
                break;
            case 'methods':
                metadataObj[entityData.keyName][metaName] = value;
                break;
            case 'params': metadataObj[entityData.keyName][metaName][value || 'default'] = entityData.index;
        }
        target[RESOURSE_METADATA_ROOT][entityType] = metadataObj;
    }
    /**
     * @param {?} requestMethodName
     * @return {?}
     */
    static requestMethod(requestMethodName) {
        // @dynamic
        return (target, key, descriptor) => {
            descriptor.value = function (...args) {
                const /** @type {?} */ url = HttpRestUtils.collectUrl(target, key, args);
                const /** @type {?} */ body = HttpRestUtils.collectBody(target, key, args);
                const /** @type {?} */ search = HttpRestUtils.collectQueryParams(target, key, args);
                const /** @type {?} */ headers = HttpRestUtils.collectHeaders(target, key, args);
                const /** @type {?} */ producesType = HttpRestUtils.produce(target, key, args);
                const /** @type {?} */ observe = HttpRestUtils.getObserve(target, key, args);
                const /** @type {?} */ params = {
                    body,
                    params: search,
                    headers,
                    responseType: producesType,
                    observe
                };
                return HttpRestUtils.http.request(requestMethodName, url, params);
            };
        };
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static getObserve(target, methodName, args) {
        if (target[RESOURSE_METADATA_ROOT].methods
            && target[RESOURSE_METADATA_ROOT].methods[methodName]) {
            return target[RESOURSE_METADATA_ROOT].methods[methodName].observe;
        }
        return undefined;
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static produce(target, methodName, args) {
        if (target[RESOURSE_METADATA_ROOT].methods
            && target[RESOURSE_METADATA_ROOT].methods[methodName]) {
            return target[RESOURSE_METADATA_ROOT].methods[methodName].produces;
        }
        return undefined;
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static collectUrl(target, methodName, args) {
        const /** @type {?} */ baseUrl = target[RESOURSE_METADATA_ROOT] && target[RESOURSE_METADATA_ROOT].class
            ? target[RESOURSE_METADATA_ROOT].class.path
            : '';
        const /** @type {?} */ methodUrl = target[RESOURSE_METADATA_ROOT].methods && target[RESOURSE_METADATA_ROOT].methods[methodName]
            ? target[RESOURSE_METADATA_ROOT].methods[methodName].path
            : '';
        const /** @type {?} */ isRelativePath = `${baseUrl}${methodUrl}`[0] === '/';
        const /** @type {?} */ methodUrlWithParams = [baseUrl, methodUrl]
            .filter(path => path)
            .join('/')
            .split('/')
            .map(path => {
            if (path[0] === ':') {
                const /** @type {?} */ paramName = path.substring(1);
                const /** @type {?} */ index = target[RESOURSE_METADATA_ROOT].params
                    && target[RESOURSE_METADATA_ROOT].params[methodName]
                    && target[RESOURSE_METADATA_ROOT].params[methodName].path
                    ? target[RESOURSE_METADATA_ROOT].params[methodName].path[paramName]
                    : '';
                return args[index];
            }
            return path;
        })
            .filter(path => path)
            .join('/');
        if (!isRelativePath) {
            const [absolutePrefix, ...paths] = methodUrlWithParams.split('/');
            return `${absolutePrefix}//${paths.join('/')}`;
        }
        return `/${methodUrlWithParams}`;
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static collectBody(target, methodName, args) {
        if (!target[RESOURSE_METADATA_ROOT].params
            || !target[RESOURSE_METADATA_ROOT].params[methodName]
            || !target[RESOURSE_METADATA_ROOT].params[methodName].body)
            return undefined;
        const /** @type {?} */ index = target[RESOURSE_METADATA_ROOT].params[methodName].body.default;
        return args[index];
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static collectQueryParams(target, methodName, args) {
        if (!target[RESOURSE_METADATA_ROOT].params
            || !target[RESOURSE_METADATA_ROOT].params[methodName]
            || !target[RESOURSE_METADATA_ROOT].params[methodName].query)
            return undefined;
        let /** @type {?} */ queryParams = new HttpParams();
        const /** @type {?} */ queryParamsObjectIndex = target[RESOURSE_METADATA_ROOT].params[methodName].query.default;
        const /** @type {?} */ queryMetadata = target[RESOURSE_METADATA_ROOT].params[methodName].query;
        const /** @type {?} */ queryParamsCollection = queryParamsObjectIndex != undefined
            ? args[queryParamsObjectIndex]
            : Object.keys(queryMetadata).reduce((mergedObj, paramName) => Object.assign(mergedObj, { [paramName]: args[queryMetadata[paramName]] }), {});
        Object.keys(queryParamsCollection)
            .forEach(paramName => {
            let /** @type {?} */ value = queryParamsCollection[paramName];
            if (!Array.isArray(value)) {
                value = [value];
            }
            value.forEach((curParam) => queryParams = queryParams.append(paramName, curParam));
        });
        return queryParams;
    }
    /**
     * @param {?} target
     * @param {?} methodName
     * @param {?} args
     * @return {?}
     */
    static collectHeaders(target, methodName, args) {
        const /** @type {?} */ classHeaders = target[RESOURSE_METADATA_ROOT].class ? target[RESOURSE_METADATA_ROOT].class.headers : {};
        const /** @type {?} */ methodHeaders = target[RESOURSE_METADATA_ROOT].methods && target[RESOURSE_METADATA_ROOT].methods[methodName]
            ? target[RESOURSE_METADATA_ROOT].methods[methodName].headers
            : {};
        const /** @type {?} */ mergedHeaders = Object.assign({}, classHeaders, methodHeaders);
        const /** @type {?} */ httpHeaders = new HttpHeaders();
        for (const /** @type {?} */ header in mergedHeaders) {
            httpHeaders.append(header, mergedHeaders[header]);
        }
        return httpHeaders;
    }
}
HttpRestUtils.http = null;
function HttpRestUtils_tsickle_Closure_declarations() {
    /** @type {?} */
    HttpRestUtils.http;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWh0dHAtYW5ub3RhdGlvbnMudXRpbHMuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtaHR0cC1hbm5vdGF0aW9ucy8iLCJzb3VyY2VzIjpbInNyYy9uZ3gtaHR0cC1hbm5vdGF0aW9ucy51dGlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBRUEsT0FBTyxFQUFjLFVBQVUsRUFBRSxXQUFXLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWMzRSxNQUFNLGtCQUFrQixXQUFnQjtJQUN0QyxNQUFNLENBQUMsQ0FBQyxHQUFHLElBQVcsRUFBRSxFQUFFLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLFdBQVcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUM7Q0FDbEc7Ozs7O0FBQ0QsTUFBTSxlQUFlLFdBQWdCO0lBQ25DLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBVyxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQztDQUMvRjs7Ozs7QUFDRCxNQUFNLGVBQWUsV0FBZ0I7SUFDbkMsTUFBTSxDQUFDLENBQUMsR0FBRyxJQUFXLEVBQUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDO0NBQy9GOzs7OztBQUNELE1BQU0sZ0JBQWdCLFdBQWdCO0lBQ3BDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsSUFBVyxFQUFFLEVBQUUsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLENB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QUFXLEVBQUUsVUFBa0IsRUFBRSxJQUFXO1FBQ3hFLHVCQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM5Ryx1QkFBTSxhQUFhLEdBQUcsTUFBTSxDQUFDLHNCQUFzQixDQUFDLENBQUMsT0FBTyxJQUFJLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7WUFDOUYsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPO1lBQzVELENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDekIsdUJBQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLFlBQVksRUFBRSxhQUFhLENBQUMsQ0FBQztRQUVyRSx1QkFBTSxXQUFXLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztRQUN0QyxHQUFHLENBQUMsQ0FBQyx1QkFBTSxNQUFNLElBQUksYUFBYSxDQUFDLENBQUMsQ0FBQztZQUNuQyxXQUFXLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztTQUNuRDtRQUNELE1BQU0sQ0FBQyxXQUFXLENBQUM7OztxQkEvS1ksSUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zLCBIdHRwSGVhZGVycyB9IGZyb20gXCJAYW5ndWxhci9jb21tb24vaHR0cFwiO1xyXG5pbXBvcnQgeyBIdHRwT2JzZXJ2ZSB9IGZyb20gXCJAYW5ndWxhci9jb21tb24vaHR0cC9zcmMvY2xpZW50XCI7XHJcblxyXG5pbnRlcmZhY2UgaHR0cFJlcXVlc3RPcHRpb25zIHtcclxuICBib2R5PzogYW55O1xyXG4gIGhlYWRlcnM/OiBIdHRwSGVhZGVycztcclxuICBwYXJhbXM/OiBIdHRwUGFyYW1zO1xyXG4gIG9ic2VydmU/OiBIdHRwT2JzZXJ2ZTtcclxuICByZXBvcnRQcm9ncmVzcz86IGJvb2xlYW47XHJcbiAgcmVzcG9uc2VUeXBlPzogJ2FycmF5YnVmZmVyJyB8ICdibG9iJyB8ICdqc29uJyB8ICd0ZXh0JztcclxuICB3aXRoQ3JlZGVudGlhbHM/OiBib29sZWFuO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG9ic2VydmUoYW5ub3RhdGlvbnM6IGFueSkge1xyXG4gIHJldHVybiAoLi4uYXJnczogYW55W10pID0+IEh0dHBSZXN0VXRpbHMuZGVjb3JhdGUuYXBwbHkodGhpcywgWydvYnNlcnZlJywgYW5ub3RhdGlvbnMsIC4uLmFyZ3NdKTtcclxufVxyXG5leHBvcnQgZnVuY3Rpb24gcGF0aChhbm5vdGF0aW9uczogYW55KSB7XHJcbiAgcmV0dXJuICguLi5hcmdzOiBhbnlbXSkgPT4gSHR0cFJlc3RVdGlscy5kZWNvcmF0ZS5hcHBseSh0aGlzLCBbJ3BhdGgnLCBhbm5vdGF0aW9ucywgLi4uYXJnc10pO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBib2R5KGFubm90YXRpb25zOiBhbnkpIHtcclxuICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiBIdHRwUmVzdFV0aWxzLmRlY29yYXRlLmFwcGx5KHRoaXMsIFsnYm9keScsIGFubm90YXRpb25zLCAuLi5hcmdzXSk7XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIHF1ZXJ5KGFubm90YXRpb25zOiBhbnkpIHtcclxuICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiBIdHRwUmVzdFV0aWxzLmRlY29yYXRlLmFwcGx5KHRoaXMsIFsncXVlcnknLCBhbm5vdGF0aW9ucywgLi4uYXJnc10pO1xyXG59XHJcbmV4cG9ydCBmdW5jdGlvbiBoZWFkZXJzKGFubm90YXRpb25zOiBhbnkpIHtcclxuICByZXR1cm4gKC4uLmFyZ3M6IGFueVtdKSA9PiBIdHRwUmVzdFV0aWxzLmRlY29yYXRlLmFwcGx5KHRoaXMsIFsnaGVhZGVycycsIGFubm90YXRpb25zLCAuLi5hcmdzXSk7XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uIHByb2R1Y2VzKGFubm90YXRpb25zOiAnYXJyYXlidWZmZXInIHwgJ2Jsb2InIHwgJ2pzb24nIHwgJ3RleHQnKSB7XHJcbiAgcmV0dXJuICguLi5hcmdzOiBhbnlbXSkgPT4gSHR0cFJlc3RVdGlscy5kZWNvcmF0ZS5hcHBseSh0aGlzLCBbJ3Byb2R1Y2VzJywgYW5ub3RhdGlvbnMsIC4uLmFyZ3NdKTtcclxufVxyXG5cclxudHlwZSBSZXNvdXJjZU1ldGFkYXRhVHlwZSA9ICdjbGFzcyd8J21ldGhvZHMnfCdwYXJhbXMnfCdwcm9wcyc7XHJcbmludGVyZmFjZSBFeHRyYUVudGl0eURhdGEge1xyXG4gIGtleU5hbWU6IHN0cmluZztcclxuICBpbmRleDogbnVtYmVyO1xyXG59XHJcbmNvbnN0IFJFU09VUlNFX01FVEFEQVRBX1JPT1QgPSAncmVzb3VyY2VzX21ldGFkYXRhJztcclxuLy8gQGR5bmFtaWNcclxuZXhwb3J0IGNsYXNzIEh0dHBSZXN0VXRpbHMge1xyXG5cclxuICBwdWJsaWMgc3RhdGljIGh0dHA6IEh0dHBDbGllbnQgPSBudWxsO1xyXG5cclxuICBwdWJsaWMgc3RhdGljIGRlY29yYXRlKGRlY29yYXRvck5hbWU6IHN0cmluZywgYW5ub3RhdGlvbnM6IGFueSwgLi4uYXJnczogYW55W10pIHtcclxuICAgIHN3aXRjaCAoYXJncy5sZW5ndGgpIHtcclxuICAgICAgICBjYXNlIDE6IHtcclxuICAgICAgICAgIGNvbnN0IFt0YXJnZXRdID0gYXJncztcclxuICAgICAgICAgIEh0dHBSZXN0VXRpbHMuY29uc3RydWN0TWV0YWRhdGEuYXBwbHkodGhpcywgWyBkZWNvcmF0b3JOYW1lLCAnY2xhc3MnLCBhbm5vdGF0aW9ucywgdGFyZ2V0LnByb3RvdHlwZSBdKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXNlIDI6IHtcclxuICAgICAgICAgIGNvbnN0IFt0YXJnZXQsIGtleV0gPSBhcmdzO1xyXG4gICAgICAgICAgSHR0cFJlc3RVdGlscy5jb25zdHJ1Y3RNZXRhZGF0YS5hcHBseSh0aGlzLCBbIGRlY29yYXRvck5hbWUsICdwcm9wcycsIGFubm90YXRpb25zLCB0YXJnZXQgXSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgaWYgKHR5cGVvZiBhcmdzWzJdID09PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICBjb25zdCBbdGFyZ2V0LCBrZXlOYW1lLCBpbmRleF0gPSBhcmdzO1xyXG4gICAgICAgICAgICBIdHRwUmVzdFV0aWxzLmNvbnN0cnVjdE1ldGFkYXRhLmFwcGx5KHRoaXMsIFsgZGVjb3JhdG9yTmFtZSwgJ3BhcmFtcycsIGFubm90YXRpb25zLCB0YXJnZXQsIHsga2V5TmFtZSwgaW5kZXggfSBdKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zdCBbdGFyZ2V0LCBrZXlOYW1lLCBkZXNjcmlwdG9yXSA9IGFyZ3M7XHJcbiAgICAgICAgICAgIEh0dHBSZXN0VXRpbHMuY29uc3RydWN0TWV0YWRhdGEuYXBwbHkodGhpcywgWyBkZWNvcmF0b3JOYW1lLCAnbWV0aG9kcycsIGFubm90YXRpb25zLCB0YXJnZXQsIHsga2V5TmFtZSB9IF0pO1xyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgIH1cclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEZWNvcmF0b3JzIGFyZSBub3QgdmFsaWQgaGVyZSEnKTtcclxuICAgICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2V0IHVwIG1ldGFkYWRhXHJcbiAgICogQHBhcmFtIHR5cGUgRW50aXR5IHR5cGVcclxuICAgKiBAcGFyYW0gdmFsdWUgVmFsdWUgb2YgbWV0YWRhdGFcclxuICAgKiBAcGFyYW0gdGFyZ2V0IFByb3RvdHlwZSBvZiBjdXJyZW50IG9iamVjdFxyXG4gICAqIEBwYXJhbSBtZXRhTmFtZSBEZWNvcmF0b3IgbmFtZVxyXG4gICAqIEBwYXJhbSBlbnRpdHlEYXRhIEVudGl0eSBleHRyYSBkYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBzdGF0aWMgY29uc3RydWN0TWV0YWRhdGEobWV0YU5hbWU6IHN0cmluZywgZW50aXR5VHlwZTogUmVzb3VyY2VNZXRhZGF0YVR5cGUsIHZhbHVlOiBhbnksIHRhcmdldDogYW55LCBlbnRpdHlEYXRhPzogRXh0cmFFbnRpdHlEYXRhKSB7XHJcbiAgICB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0gPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0gfHwge307XHJcbiAgICB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF1bZW50aXR5VHlwZV0gPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF1bZW50aXR5VHlwZV0gfHwge307XHJcblxyXG4gICAgY29uc3Qgcm9vdE1ldGFkYXRhID0gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdO1xyXG4gICAgY29uc3QgbWV0YWRhdGFPYmogPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF1bZW50aXR5VHlwZV07XHJcbiAgICBpZiAoZW50aXR5RGF0YSAmJiBlbnRpdHlEYXRhLmtleU5hbWUpIHtcclxuICAgICAgbWV0YWRhdGFPYmpbZW50aXR5RGF0YS5rZXlOYW1lXSA9IG1ldGFkYXRhT2JqW2VudGl0eURhdGEua2V5TmFtZV0gfHwge307XHJcbiAgICB9XHJcbiAgICBpZiAoZW50aXR5RGF0YSAmJiBlbnRpdHlEYXRhLmluZGV4ICE9IG51bGwpIHtcclxuICAgICAgbWV0YWRhdGFPYmpbZW50aXR5RGF0YS5rZXlOYW1lXVttZXRhTmFtZV0gPSBtZXRhZGF0YU9ialtlbnRpdHlEYXRhLmtleU5hbWVdW21ldGFOYW1lXSB8fCB7fTtcclxuICAgIH1cclxuICAgIHN3aXRjaCAoZW50aXR5VHlwZSkge1xyXG4gICAgICBjYXNlICdjbGFzcyc6IG1ldGFkYXRhT2JqW21ldGFOYW1lXSA9IHZhbHVlOyBicmVhaztcclxuICAgICAgY2FzZSAncHJvcHMnOiBtZXRhZGF0YU9ialttZXRhTmFtZV0gPSB2YWx1ZTsgYnJlYWs7XHJcbiAgICAgIGNhc2UgJ21ldGhvZHMnOiBtZXRhZGF0YU9ialtlbnRpdHlEYXRhLmtleU5hbWVdW21ldGFOYW1lXSA9IHZhbHVlOyBicmVhaztcclxuICAgICAgY2FzZSAncGFyYW1zJzogbWV0YWRhdGFPYmpbZW50aXR5RGF0YS5rZXlOYW1lXVttZXRhTmFtZV1bdmFsdWUgfHwgJ2RlZmF1bHQnXSA9IGVudGl0eURhdGEuaW5kZXg7XHJcbiAgICB9XHJcblxyXG4gICAgdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdW2VudGl0eVR5cGVdID0gbWV0YWRhdGFPYmo7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgc3RhdGljIHJlcXVlc3RNZXRob2QocmVxdWVzdE1ldGhvZE5hbWU6IHN0cmluZyk6IGFueSB7XHJcbiAgICAgIC8vIEBkeW5hbWljXHJcbiAgICByZXR1cm4gKHRhcmdldDogYW55LCBrZXk6IHN0cmluZywgZGVzY3JpcHRvcjogYW55KSA9PiB7XHJcbiAgICAgIGRlc2NyaXB0b3IudmFsdWUgPSBmdW5jdGlvbiAoLi4uYXJnczogYW55W10pIHtcclxuICAgICAgICBjb25zdCB1cmwgPSBIdHRwUmVzdFV0aWxzLmNvbGxlY3RVcmwodGFyZ2V0LCBrZXksIGFyZ3MpO1xyXG4gICAgICAgIGNvbnN0IGJvZHkgPSBIdHRwUmVzdFV0aWxzLmNvbGxlY3RCb2R5KHRhcmdldCwga2V5LCBhcmdzKTtcclxuICAgICAgICBjb25zdCBzZWFyY2ggPSBIdHRwUmVzdFV0aWxzLmNvbGxlY3RRdWVyeVBhcmFtcyh0YXJnZXQsIGtleSwgYXJncyk7XHJcbiAgICAgICAgY29uc3QgaGVhZGVycyA9IEh0dHBSZXN0VXRpbHMuY29sbGVjdEhlYWRlcnModGFyZ2V0LCBrZXksIGFyZ3MpO1xyXG4gICAgICAgIGNvbnN0IHByb2R1Y2VzVHlwZSA9IEh0dHBSZXN0VXRpbHMucHJvZHVjZSh0YXJnZXQsIGtleSwgYXJncyk7XHJcbiAgICAgICAgY29uc3Qgb2JzZXJ2ZSA9IEh0dHBSZXN0VXRpbHMuZ2V0T2JzZXJ2ZSh0YXJnZXQsIGtleSwgYXJncylcclxuICAgICAgICBjb25zdCBwYXJhbXM6IGh0dHBSZXF1ZXN0T3B0aW9ucyA9IHtcclxuICAgICAgICAgIGJvZHksXHJcbiAgICAgICAgICBwYXJhbXM6IHNlYXJjaCxcclxuICAgICAgICAgIGhlYWRlcnMsXHJcbiAgICAgICAgICByZXNwb25zZVR5cGU6IHByb2R1Y2VzVHlwZSxcclxuICAgICAgICAgIG9ic2VydmVcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBIdHRwUmVzdFV0aWxzLmh0dHAucmVxdWVzdChyZXF1ZXN0TWV0aG9kTmFtZSwgdXJsLCBwYXJhbXMpO1xyXG4gICAgICB9O1xyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIGdldE9ic2VydmUodGFyZ2V0OiBhbnksIG1ldGhvZE5hbWU6IHN0cmluZywgYXJnczogYW55W10pIHtcclxuICAgIGlmICh0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ubWV0aG9kc1xyXG4gICAgICAmJiB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ubWV0aG9kc1ttZXRob2ROYW1lXSkge1xyXG4gICAgICAgcmV0dXJuIHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5tZXRob2RzW21ldGhvZE5hbWVdLm9ic2VydmU7XHJcbiAgICAgfVxyXG4gICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBwcm9kdWNlKHRhcmdldDogYW55LCBtZXRob2ROYW1lOiBzdHJpbmcsIGFyZ3M6IGFueVtdKSB7XHJcbiAgICBpZiAodGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLm1ldGhvZHNcclxuICAgICAmJiB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ubWV0aG9kc1ttZXRob2ROYW1lXSkge1xyXG4gICAgICByZXR1cm4gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLm1ldGhvZHNbbWV0aG9kTmFtZV0ucHJvZHVjZXM7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBzdGF0aWMgY29sbGVjdFVybCh0YXJnZXQ6IGFueSwgbWV0aG9kTmFtZTogc3RyaW5nLCBhcmdzOiBhbnlbXSkge1xyXG4gICAgY29uc3QgYmFzZVVybCA9IHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXSAmJiB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0uY2xhc3NcclxuICAgICAgICAgICAgICAgICAgPyB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0uY2xhc3MucGF0aFxyXG4gICAgICAgICAgICAgICAgICA6ICcnO1xyXG4gICAgY29uc3QgbWV0aG9kVXJsID0gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLm1ldGhvZHMgJiYgdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLm1ldGhvZHNbbWV0aG9kTmFtZV1cclxuICAgICAgICAgICAgICAgICAgICA/IHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5tZXRob2RzW21ldGhvZE5hbWVdLnBhdGhcclxuICAgICAgICAgICAgICAgICAgICA6ICcnO1xyXG4gICAgY29uc3QgaXNSZWxhdGl2ZVBhdGggPSBgJHtiYXNlVXJsfSR7bWV0aG9kVXJsfWBbMF0gPT09ICcvJztcclxuICAgIGNvbnN0IG1ldGhvZFVybFdpdGhQYXJhbXNcclxuICAgICAgPSBbYmFzZVVybCwgbWV0aG9kVXJsXVxyXG4gICAgICAgIC5maWx0ZXIocGF0aCA9PiBwYXRoKVxyXG4gICAgICAgIC5qb2luKCcvJylcclxuICAgICAgICAuc3BsaXQoJy8nKVxyXG4gICAgICAgIC5tYXAocGF0aCA9PiB7XHJcbiAgICAgICAgICBpZiAoIHBhdGhbMF0gPT09ICc6Jykge1xyXG4gICAgICAgICAgICBjb25zdCBwYXJhbU5hbWUgPSBwYXRoLnN1YnN0cmluZygxKTtcclxuICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ucGFyYW1zXHJcbiAgICAgICAgICAgICAgICAgICAgICAgJiYgdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLnBhcmFtc1ttZXRob2ROYW1lXVxyXG4gICAgICAgICAgICAgICAgICAgICAgICYmIHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5wYXJhbXNbbWV0aG9kTmFtZV0ucGF0aFxyXG4gICAgICAgICAgICAgICAgICAgICAgICA/IHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5wYXJhbXNbbWV0aG9kTmFtZV0ucGF0aFtwYXJhbU5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogJyc7XHJcbiAgICAgICAgICAgIHJldHVybiBhcmdzW2luZGV4XTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHJldHVybiBwYXRoO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmZpbHRlcihwYXRoID0+IHBhdGgpXHJcbiAgICAgICAgLmpvaW4oJy8nKTtcclxuXHJcbiAgICBpZiAoIWlzUmVsYXRpdmVQYXRoKSB7XHJcbiAgICAgIGNvbnN0IFthYnNvbHV0ZVByZWZpeCwgLi4ucGF0aHNdID0gbWV0aG9kVXJsV2l0aFBhcmFtcy5zcGxpdCgnLycpO1xyXG4gICAgICByZXR1cm4gYCR7IGFic29sdXRlUHJlZml4IH0vLyR7IHBhdGhzLmpvaW4oJy8nKSB9YDtcclxuICAgIH1cclxuICAgIHJldHVybiBgLyR7IG1ldGhvZFVybFdpdGhQYXJhbXMgfWA7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBjb2xsZWN0Qm9keSh0YXJnZXQ6IGFueSwgbWV0aG9kTmFtZTogc3RyaW5nLCBhcmdzOiBhbnlbXSkge1xyXG4gICAgaWYgKCF0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ucGFyYW1zXHJcbiAgICAgfHwgIXRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5wYXJhbXNbbWV0aG9kTmFtZV1cclxuICAgICB8fCAhdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLnBhcmFtc1ttZXRob2ROYW1lXS5ib2R5KSByZXR1cm4gdW5kZWZpbmVkO1xyXG5cclxuICAgIGNvbnN0IGluZGV4ID0gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLnBhcmFtc1ttZXRob2ROYW1lXS5ib2R5LmRlZmF1bHQ7XHJcbiAgICByZXR1cm4gYXJnc1tpbmRleF07XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIHN0YXRpYyBjb2xsZWN0UXVlcnlQYXJhbXModGFyZ2V0OiBhbnksIG1ldGhvZE5hbWU6IHN0cmluZywgYXJnczogYW55W10pIHtcclxuICAgIGlmICghdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLnBhcmFtc1xyXG4gICAgIHx8ICF0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ucGFyYW1zW21ldGhvZE5hbWVdXHJcbiAgICAgfHwgIXRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5wYXJhbXNbbWV0aG9kTmFtZV0ucXVlcnkpIHJldHVybiB1bmRlZmluZWQ7XHJcblxyXG4gICAgbGV0IHF1ZXJ5UGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcclxuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zT2JqZWN0SW5kZXggPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0ucGFyYW1zW21ldGhvZE5hbWVdLnF1ZXJ5LmRlZmF1bHQ7XHJcbiAgICBjb25zdCBxdWVyeU1ldGFkYXRhID0gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLnBhcmFtc1ttZXRob2ROYW1lXS5xdWVyeTtcclxuICAgIGNvbnN0IHF1ZXJ5UGFyYW1zQ29sbGVjdGlvbiA9IHF1ZXJ5UGFyYW1zT2JqZWN0SW5kZXggIT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyBhcmdzW3F1ZXJ5UGFyYW1zT2JqZWN0SW5kZXhdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBPYmplY3Qua2V5cyhxdWVyeU1ldGFkYXRhKS5yZWR1Y2UoKG1lcmdlZE9iaiwgcGFyYW1OYW1lKSA9PlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihtZXJnZWRPYmosIHsgW3BhcmFtTmFtZV06IGFyZ3NbcXVlcnlNZXRhZGF0YVtwYXJhbU5hbWVdXSB9KSwge31cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xyXG5cclxuICAgIE9iamVjdC5rZXlzKHF1ZXJ5UGFyYW1zQ29sbGVjdGlvbilcclxuICAgICAgLmZvckVhY2gocGFyYW1OYW1lID0+IHtcclxuICAgICAgICBsZXQgdmFsdWUgPSBxdWVyeVBhcmFtc0NvbGxlY3Rpb25bcGFyYW1OYW1lXTtcclxuICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7IHZhbHVlID0gWyB2YWx1ZSBdOyB9XHJcbiAgICAgICAgdmFsdWUuZm9yRWFjaCgoY3VyUGFyYW06IGFueSkgPT4gcXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtcy5hcHBlbmQocGFyYW1OYW1lLCBjdXJQYXJhbSkpO1xyXG4gICAgICB9KTtcclxuICAgIHJldHVybiBxdWVyeVBhcmFtcztcclxuICB9XHJcblxyXG4gIHByaXZhdGUgc3RhdGljIGNvbGxlY3RIZWFkZXJzKHRhcmdldDogYW55LCBtZXRob2ROYW1lOiBzdHJpbmcsIGFyZ3M6IGFueVtdKSB7XHJcbiAgICBjb25zdCBjbGFzc0hlYWRlcnMgPSB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0uY2xhc3MgPyB0YXJnZXRbUkVTT1VSU0VfTUVUQURBVEFfUk9PVF0uY2xhc3MuaGVhZGVycyA6IHt9O1xyXG4gICAgY29uc3QgbWV0aG9kSGVhZGVycyA9IHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5tZXRob2RzICYmIHRhcmdldFtSRVNPVVJTRV9NRVRBREFUQV9ST09UXS5tZXRob2RzW21ldGhvZE5hbWVdXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gdGFyZ2V0W1JFU09VUlNFX01FVEFEQVRBX1JPT1RdLm1ldGhvZHNbbWV0aG9kTmFtZV0uaGVhZGVyc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IHt9O1xyXG4gICAgY29uc3QgbWVyZ2VkSGVhZGVycyA9IE9iamVjdC5hc3NpZ24oe30sIGNsYXNzSGVhZGVycywgbWV0aG9kSGVhZGVycyk7XHJcblxyXG4gICAgY29uc3QgaHR0cEhlYWRlcnMgPSBuZXcgSHR0cEhlYWRlcnMoKTtcclxuICAgIGZvciAoY29uc3QgaGVhZGVyIGluIG1lcmdlZEhlYWRlcnMpIHtcclxuICAgICAgaHR0cEhlYWRlcnMuYXBwZW5kKGhlYWRlciwgbWVyZ2VkSGVhZGVyc1toZWFkZXJdKTtcclxuICAgIH1cclxuICAgIHJldHVybiBodHRwSGVhZGVycztcclxuICB9XHJcbn0iXX0=